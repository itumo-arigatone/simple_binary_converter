# 履歴機能 詳細仕様書

## 概要

変換履歴を保存し、過去の変換結果を簡単に参照・再利用できる機能。

## 機能要件

### 1. 履歴の保存

#### 1.1 保存タイミング
- 変換実行時（下スワイプで変換した時）に自動保存

#### 1.2 保存データ
| フィールド | 型 | 説明 | 例 |
|-----------|------|------|-----|
| input | String | 入力値 | `"1010"` |
| result | String | 変換結果 | `"10"` |
| type | String | 変換タイプ | `"BIN → DEC"` |
| timestamp | int | 保存時刻（Unix時間） | `1703123456789` |

#### 1.3 変換タイプの表記
| convertMode | 表記 |
|-------------|------|
| 0 | BIN → DEC |
| 1 | BIN → HEX |
| 2 | DEC → BIN |
| 3 | DEC → HEX |
| 4 | HEX → BIN |
| 5 | HEX → DEC |

#### 1.4 保存制限
- 最大保存件数: **20件**
- 上限を超えた場合: 最も古い履歴を自動削除

#### 1.5 重複の扱い
- 直近の同じ入力値・変換タイプの履歴は上書きしない（新規追加）

### 2. 履歴の表示

#### 2.1 表示トリガー
- 結果表示エリアをタップ
  - タップすると履歴が表示されるとわかるレイアウトに調整

#### 2.2 表示形式
- モーダルボトムシート（画面下部からスライドアップ）

#### 2.3 リスト項目の表示内容
```
[変換タイプ]
入力値 → 変換結果
```

例:
```
BIN → DEC
1010 → 10
```

#### 2.4 リストの並び順
- 新しい順（最新の履歴が上）

#### 2.5 空の場合
- 「履歴がありません」と表示

### 3. 履歴からの操作

#### 3.1 履歴アイテムをタップ
- 入力値を現在の入力欄に復元
- 変換タイプ（モード）を復元
- 変換を実行
- モーダルを閉じる

#### 3.2 履歴の削除
- 個別削除: 履歴アイテムを左スワイプで削除
- 全削除: モーダルヘッダーに「全削除」ボタン

### 4. データ永続化

#### 4.1 保存方法
- `shared_preferences` を使用
- JSON形式でリストを保存

#### 4.2 保存キー
- `conversion_history`

#### 4.3 データ形式
```json
[
  {
    "input": "1010",
    "result": "10",
    "type": "BIN → DEC",
    "timestamp": 1703123456789
  },
  ...
]
```

## UI仕様

### 1. 結果表示エリア

#### 変更点
- タップ可能であることを示すビジュアルヒント追加
  - 履歴がある場合: 小さな履歴アイコン（`Icons.history`）を表示

### 2. 履歴モーダル

#### 2.1 ヘッダー
```
┌─────────────────────────────┐
│  履歴            [全削除]   │
└─────────────────────────────┘
```

#### 2.2 リスト
```
┌─────────────────────────────┐
│ BIN → DEC                   │
│ 1010 → 10                   │
├─────────────────────────────┤
│ HEX → DEC                   │
│ FF → 255                    │
├─────────────────────────────┤
│ ...                         │
└─────────────────────────────┘
```

#### 2.3 空状態
```
┌─────────────────────────────┐
│                             │
│     履歴がありません        │
│                             │
└─────────────────────────────┘
```

### 3. スタイル
- 背景色: `Color(0xFFF0F0F3)`（アプリ全体と統一）
- ニューモーフィズムスタイルを適用

## 実装計画

### ファイル構成
```
lib/
├── history/
│   ├── history_model.dart      # 履歴データモデル
│   ├── history_service.dart    # 履歴の保存・読み込み
│   └── history_modal.dart      # 履歴モーダルUI
└── main.dart                   # 既存（履歴機能を統合）
```

### 実装順序
1. `history_model.dart` - データモデル作成
2. `history_service.dart` - 永続化ロジック
3. `history_modal.dart` - UI実装
4. `main.dart` - 統合（結果エリアのタップ処理、変換時の保存処理）

## 非機能要件

### パフォーマンス
- 20件程度のデータなので、パフォーマンスへの影響は軽微
- アプリ起動時に履歴をロード

### エラーハンドリング
- JSONパースエラー時: 履歴をクリアして初期化
- 保存失敗時: サイレントに失敗（ユーザー通知なし）

